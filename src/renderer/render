#!/usr/bin/env php
<?php

/**
 * ---------------------------------------------------------------------------------------------------
 * This script is part of the nightwind-cli, it is used internally by the `nightwind render` command
 * for generating your `.nightwind/template` rendered files. Changing this file is not recommended
 * unless you have some custom needs not met by the cli natively.
 * ---------------------------------------------------------------------------------------------------
 */
require_once 'vendor/autoload.php';


use BladeCLI\Blade;
use Illuminate\Support\Str;
use Illuminate\Container\Container;
use Symfony\Component\Finder\Finder;
use Illuminate\Filesystem\Filesystem;
use BladeCLI\Support\Concerns\LoadsJsonFiles;

$options = ['save-directory'=>'/app/.project/.rendered'];

$finder = new Finder;
$files = $finder->in(__DIR__."/.project/templates")->files();

class JsonFileLoader {
    use LoadsJsonFiles;
}

$jsonVariableFile = '/app/.project/variables.json';
$variables = file_exists($jsonVariableFile) ? (new JsonFileLoader)->loadJsonFile($jsonVariableFile) : [];

$data = [];
foreach($variables as $k=>$v){
    $data[Str::camel($k)] = $v;
}

dd($data);

foreach($files as $file){
    $blade = new Blade(
        container: new Container,
        filesystem: new Filesystem,
        filePath: $file->getPathName(),
        options: $options
    );

    $blade->render($variables);
}

